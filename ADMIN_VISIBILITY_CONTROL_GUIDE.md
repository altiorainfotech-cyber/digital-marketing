# Admin Visibility Control - Visual Guide

## Feature Location

The visibility control feature is located on the **Asset Detail Page** in the **Details** section (right sidebar).

## UI Components

### 1. Visibility Display (All Users)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Details                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ Asset Type                       â”‚
â”‚    IMAGE                            â”‚
â”‚                                     â”‚
â”‚ ğŸ“„ Upload Type                      â”‚
â”‚    SEO                              â”‚
â”‚                                     â”‚
â”‚ ğŸ‘ï¸ Visibility                       â”‚
â”‚    PUBLIC                           â”‚  â† Shows current visibility
â”‚                                     â”‚
â”‚ ğŸ’¾ File Size                        â”‚
â”‚    2.45 MB                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Visibility Display with Change Button (Admin Only, Approved Assets)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Details                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ Asset Type                       â”‚
â”‚    IMAGE                            â”‚
â”‚                                     â”‚
â”‚ ğŸ“„ Upload Type                      â”‚
â”‚    SEO                              â”‚
â”‚                                     â”‚
â”‚ ğŸ‘ï¸ Visibility                       â”‚
â”‚    PUBLIC              [Change]     â”‚  â† Admin sees "Change" button
â”‚                                     â”‚
â”‚ ğŸ’¾ File Size                        â”‚
â”‚    2.45 MB                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Visibility Change Modal

When admin clicks "Change", a modal appears:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Change Asset Visibility                  âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚  Change visibility for: My Asset Title        â”‚
â”‚                                               â”‚
â”‚  Visibility Level                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Public (Everyone)                    â–¼  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  Choose who can view this asset               â”‚
â”‚                                               â”‚
â”‚  Options:                                     â”‚
â”‚  â€¢ Private (Uploader Only)                    â”‚
â”‚  â€¢ Admin Only                                 â”‚
â”‚  â€¢ Public (Everyone)                          â”‚
â”‚  â€¢ Company                                    â”‚
â”‚  â€¢ SEO Specialist Role                        â”‚
â”‚  â€¢ Content Creator Role                       â”‚
â”‚  â€¢ Selected Users                             â”‚
â”‚                                               â”‚
â”‚                    [Cancel] [Update Visibility]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## User Flow

### Admin User Flow

```
1. Admin logs in
   â†“
2. Navigates to Assets page
   â†“
3. Sees ALL approved assets (regardless of visibility)
   â†“
4. Clicks on an approved asset
   â†“
5. Views asset detail page
   â†“
6. Sees "Change" button next to Visibility in Details section
   â†“
7. Clicks "Change"
   â†“
8. Modal opens with visibility options
   â†“
9. Selects new visibility level
   â†“
10. Clicks "Update Visibility"
    â†“
11. Visibility is updated
    â†“
12. Success message appears
    â†“
13. Change is logged to audit trail
```

### Non-Admin User Flow

```
1. User logs in (Content Creator or SEO Specialist)
   â†“
2. Navigates to Assets page
   â†“
3. Sees only assets they have permission to view
   â†“
4. Clicks on an asset
   â†“
5. Views asset detail page
   â†“
6. Sees visibility level (NO "Change" button)
   â†“
7. Cannot modify visibility
```

## Visibility Behavior

### Before This Feature

| User Role        | Can See All Assets? | Can Change Visibility? |
|------------------|---------------------|------------------------|
| Admin            | âœ… Yes              | âŒ No                  |
| Content Creator  | âŒ No (filtered)    | âŒ No                  |
| SEO Specialist   | âŒ No (filtered)    | âŒ No                  |

### After This Feature

| User Role        | Can See All Assets? | Can Change Visibility? |
|------------------|---------------------|------------------------|
| Admin            | âœ… Yes              | âœ… Yes (approved only) |
| Content Creator  | âŒ No (filtered)    | âŒ No                  |
| SEO Specialist   | âŒ No (filtered)    | âŒ No                  |

## Visibility Options Explained

### 1. Private (Uploader Only)
- **Who can see**: Only the person who uploaded the asset
- **Use case**: Personal drafts, private content

### 2. Admin Only
- **Who can see**: Admins and the uploader
- **Use case**: Sensitive content that needs admin review

### 3. Public (Everyone)
- **Who can see**: All authenticated users
- **Use case**: Company-wide resources, general content

### 4. Company
- **Who can see**: All users in the same company as the asset
- **Use case**: Company-specific content

### 5. SEO Specialist Role
- **Who can see**: Only users with SEO Specialist role
- **Use case**: SEO-specific resources and content

### 6. Content Creator Role
- **Who can see**: Only users with Content Creator role
- **Use case**: Content creation resources

### 7. Selected Users
- **Who can see**: Only users explicitly shared with
- **Use case**: Collaborative projects, specific team members

## Example Scenarios

### Scenario 1: Making an Asset Public

**Situation**: An approved asset is currently set to "Company" visibility, but the admin wants to make it available to everyone.

**Steps**:
1. Admin navigates to the asset detail page
2. Sees "Visibility: COMPANY [Change]"
3. Clicks "Change"
4. Selects "Public (Everyone)" from dropdown
5. Clicks "Update Visibility"
6. Asset is now visible to all users

### Scenario 2: Restricting to Specific Role

**Situation**: An approved asset contains SEO-specific information and should only be visible to SEO Specialists.

**Steps**:
1. Admin navigates to the asset detail page
2. Sees "Visibility: PUBLIC [Change]"
3. Clicks "Change"
4. Selects "SEO Specialist Role" from dropdown
5. Clicks "Update Visibility"
6. Asset is now only visible to SEO Specialists (and admins)

### Scenario 3: Making Asset Private Again

**Situation**: An asset was accidentally made public and needs to be restricted back to the uploader.

**Steps**:
1. Admin navigates to the asset detail page
2. Sees "Visibility: PUBLIC [Change]"
3. Clicks "Change"
4. Selects "Private (Uploader Only)" from dropdown
5. Clicks "Update Visibility"
6. Asset is now only visible to the uploader (and admins)

## Security Notes

- âœ… Only admins can change visibility
- âœ… Only approved assets can have visibility changed
- âœ… All changes are logged to audit trail
- âœ… Non-admin users cannot access the API endpoint
- âœ… Validation ensures only valid visibility levels are accepted

## Troubleshooting

### "Change" button not appearing

**Possible causes**:
1. User is not an admin
2. Asset is not in APPROVED status
3. Page needs to be refreshed

**Solution**: Verify user role and asset status

### Visibility change fails

**Possible causes**:
1. Network error
2. Invalid visibility level
3. Asset not found
4. Permission denied

**Solution**: Check browser console for error messages, verify admin permissions

### Changes not reflected immediately

**Possible causes**:
1. Cache not cleared
2. Page not refreshed

**Solution**: Refresh the page to see updated visibility

## API Reference

### Endpoint
```
PATCH /api/assets/[id]/visibility
```

### Headers
```
Content-Type: application/json
Authorization: Bearer <token>
```

### Request Body
```json
{
  "visibility": "PUBLIC",
  "allowedRole": null
}
```

### Response (Success)
```json
{
  "id": "asset-id",
  "visibility": "PUBLIC",
  "allowedRole": null,
  "message": "Visibility updated successfully"
}
```

### Response (Error - Not Admin)
```json
{
  "error": "Only administrators can update asset visibility"
}
```
Status: 403 Forbidden

### Response (Error - Invalid Visibility)
```json
{
  "error": "Valid visibility level is required"
}
```
Status: 400 Bad Request
